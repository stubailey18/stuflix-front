import { Component } from 'react';
import { fetchProgramDetail, fetchPrograms } from '../services/ProgramService';
import { ProgramDetail } from './ProgramDetail';
import ProgramSearch from './ProgramSearch';
import ProgramTable from './ProgramTable';

// this is a smart component; it knows about the source of the data
// it doesn't render anything itself but instead delegates the rendering to a dumb component
export default class Programs extends Component {

    constructor() {
        super();
        this.state = {
            programs: [],
            selectedProgram: null
        };
        this.handleSearch = this.handleSearch.bind(this);
        this.handleProgramSelected = this.handleProgramSelected.bind(this);
        this.handleProgramDeselected = this.handleProgramDeselected.bind(this);
    }

    handleSearch(searchTerm) {
        fetchPrograms(searchTerm)
            .then(dataFromApi => this.setState({programs: dataFromApi}))
            .catch(error => console.log(error));
    }

    handleProgramSelected(imdbID) {
        fetchProgramDetail(imdbID)
            .then(program => this.setState({selectedProgram: program}))
            .catch(error => console.log(error));
    }

    handleProgramDeselected() {
        this.setState({selectedProgram: null});
    }

    render() {
        const {programs, selectedProgram} = this.state;
        return (
            <>
                <ProgramSearch onSearch={this.handleSearch} />
                {/* if selectedProgram is falsey (null) then render ProgramTable */}
                {!selectedProgram && <ProgramTable 
                    programs={programs} 
                    onProgramSelected={this.handleProgramSelected} />}
                {/* if selectedProgram is truthy (not null) then render ProgramDetail */}
                {selectedProgram && <ProgramDetail 
                    program={selectedProgram}
                    onProgramDeselected={this.handleProgramDeselected} />}
            </>
        );
    }
}